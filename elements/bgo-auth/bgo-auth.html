<link rel="import" href="TODO/polymer.html">
<link rel="import" href="TODO/paper-button.html">
<link rel="import" href="TODO/paper-button.html">
<link rel="import" href="TODO/firebase-auth.html">

<dom-module id="bgo-auth">
  <template>
    <firebase-auth id="firebaseLogin" user="{{user}}" status-known="{{statusKnown}}" location="https://bugover.firebaseio.com" provider="{{provider}}" on-error="errorHandler" on-user-created="userSuccessHandler" on-password-changed="userSuccessHandler" on-password-reset="userSuccessHandler" on-user-removed="userSuccessHandler"></firebase-auth>

    <paper-button on-tap="register" hidden$="{{statusKnown}}">Register</paper-button> 
    <paper-button on-tap="login" hidden$="{{statusKnown}}">Register</paper-button> 
    <paper-button on-tap="logout" hidden$="!{{statusKnown}}">Register</paper-button>

    <paper-dialog id="bgo-auth-dialog" modal>
      <h2 id="title"></h2>
      <paper-input label="Email"></paper-input>
      <paper-input label="Password" type="password"></paper-input>
      <paper-input label="Verify Password" type="password" hidden$="{{statusKnown}}"></paper-input>
      <paper-button TODO>Action</paper-button> 
      <paper-button TODO>Cancel</paper-button> 
    </paper-dialog>

  </template>
</dom-module>
<script>
  Polymer({
    is: 'bgo-auth',

    properties: {
      provider: {
        type: String,
        value: 'anonymous'
      },

      message: {
        type: String,
        value: ''
      },

      user: {
        type: Object,
        value: null
      },

      statusKnown: {
        type: Boolean
      }
    },

    login: function() {
      this.$.bgo-auth-dialog.title = "Login";
      this.$.bgo-auth-dialog.open();

      //TODO: move in dialog... this.$.firebaseLogin.login(params);
    },

    logout: function() {
      this.$.firebaseLogin.logout();
    },

    errorHandler: function(e) {
      this.message = 'Error: ' + e.detail.message;
    },

    userSuccessHandler: function(e) {
      console.log(e.type + ' success!';
    },

    createUserHandler: function(e) {
      this.$.firebaseLogin.createUser(this.email, this.password);
    },

    changePasswordHandler: function(e) {
      this.$.firebaseLogin.changePassword(this.email, this.password, this.newPassword);
    },

    resetPasswordHandler: function(e) {
      this.$.firebaseLogin.sendPasswordResetEmail(this.email);
    },

    computeLoginStatus: function(statusKnown, user) {
      if (statusKnown && user) {
        return 'Logged in';
      }

      if (statusKnown) {
        return 'Logged out';
      }

      return 'Unknown (checking status...)';
    }
  });
</script>
